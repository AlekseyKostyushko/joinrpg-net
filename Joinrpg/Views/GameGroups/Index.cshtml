@using JoinRpg.Web.Models
@model GameRolesViewModel

@{
    ViewBag.Title = "Сетка ролей " + Model.ProjectName;
}

<h2>@ViewBag.Title</h2>

    @foreach (var item in Model.ShowEditControls ? Model.Data.ActiveGroups :  Model.Data.PublicGroups)
    {
        <div style="margin-left: @(item.DeepLevel)em">
            @if (item.DeepLevel > 2)
            {
            @* Get rid of code duplication here*@
            <h4 title="@(string.Join("→", item.Path) + item.Name)">@Html.ActionLink(item.Name, "Index", new { Model.ProjectId, item.CharacterGroupId }, null)</h4>
            }
            else if (item.DeepLevel == 2)
            {
              @* Get rid of code duplication here*@
                <h3 title="@(string.Join("→", item.Path) + item.Name)">@Html.ActionLink(item.Name, "Index", new {Model.ProjectId, item.CharacterGroupId}, null)</h3>
            }
            else
            {
                <h2 title="@(string.Join("→", item.Path) + item.Name)">@Html.ActionLink(item.Name, "Index", new { Model.ProjectId, item.CharacterGroupId }, null)</h2>
            }

            @if (!item.FirstCopy)
            {
                <span>см. выше</span>
            }

            @if (item.FirstCopy)
            {
                <div>
                    @if (Model.ShowEditControls)
                    {
                        <span>
@Html.ActionLink("Список заявок", "ListForGroup", "Claim", new { Model.ProjectId, item.CharacterGroupId }, null) |
        @Html.ActionLink("Редактировать", "Edit", new {Model.ProjectId, item.CharacterGroupId}, null) |
@if (!item.IsRoot && item.ActiveClaimsCount == 0)
{
    <span>
    @Html.ActionLink("Удалить", "Delete", new {Model.ProjectId, item.CharacterGroupId}, null)
    |
</span>
}
    Добавить
    @Html.ActionLink("персонажа", "Create", "Character", new {Model.ProjectId, item.CharacterGroupId}, null) |
    @Html.ActionLink("подгруппу", "AddGroup", new {Model.ProjectId, item.CharacterGroupId}, null)
</span>
                    }
                    @item.Description
                    <ul>
                        @foreach (var character in Model.ShowEditControls ? item.ActiveCharacters : item.PublicCharacters)
                        {
                            <li>
                                <strong>@Html.ActionLink(character.CharacterName, "Details", "Character", new {Model.ProjectId, character.CharacterId}, null) </strong>
                                @if (character.Player != null)
                                {
                                    <span> @Html.DisplayFor(m => character.Player)</span>
                                }
                                else if (Model.ShowEditControls && character.ActiveClaimsCount > 0)
                                {
                                    @DisplayCount.OfX(character.ActiveClaimsCount, "заявка", "заявки", "заявок")
                                }
                                @if (character.IsAvailable)
                                {
                                    @Html.ActionLink("заявиться", "AddForCharacter", "Claim", new {Model.ProjectId, character.CharacterId}, null)
                                }
                                @if (character.IsFirstCopy)
                                {
                                    <div>@character.Description</div>
                                    if (Model.ShowEditControls && character.ActiveClaimsCount == 0)
                                    {
                                        @Html.ActionLink("удалить", "Delete", "Character", new {Model.ProjectId, character.CharacterId}, null)
                                    }
                                }
                                else
                                {
                                    <span>(см. выше)</span>
                                }
                            </li>
                        }
                    </ul>


                    <div>
                        @if (item.AvaiableDirectSlots > 0)
                        {
                            <strong>+@item.AvaiableDirectSlots вакансий: </strong>
                        }
                        else if (item.AvaiableDirectSlots < 0)
                        {
                            <strong>есть вакансии: </strong>
                        }
                        @if (Model.ShowEditControls &&
                             item.ActiveClaimsCount > 0)
                        {
                            @Html.ActionLink(DisplayCount.OfX(item.ActiveClaimsCount, "заявка", "заявки", "заявок"), "ListForGroupDirect", "Claim", new { Model.ProjectId, item.CharacterGroupId }, null)
                        }
                        @if (item.AvaiableDirectSlots != 0)
                        {
                            @Html.ActionLink("заявиться", "AddForGroup", "Claim", new {Model.ProjectId, item.CharacterGroupId}, null)
                        }

                    </div>


                </div>
            }
        </div>
    }
